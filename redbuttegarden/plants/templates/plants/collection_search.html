{% extends 'base.html' %}


{% block content %}
    <div class="search">
        <form>
            <div class="form-group">
                <label for="exampleInputEmail1">Email address</label>
                <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
                <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
            </div>
            <div class="form-group">
                <label for="exampleInputPassword1">Password</label>
                <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
            </div>
            <div class="form-group form-check">
                <input type="checkbox" class="form-check-input" id="exampleCheck1">
                <label class="form-check-label" for="exampleCheck1">Check me out</label>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

    <div class="results">
        <ul>
            {% for collection in collections %}
                <li>{{ collection.species.name }}</li>
            {% endfor %}
            <div id="newItems"></div>
        </ul>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        $(document).ready(function(){
            $(window).bind('scroll', loadOnScroll);
        });

        // Scroll globals
        var pageNum = 1; // The latest page loaded
        var hasNextPage = true; // Indicates whether to expect another page after this one

        // loadOnScroll handler
        var loadOnScroll = function() {
            // If the current scroll position is past out cutoff point...
            if ($(window).scrollTop() > $(document).height() - ($(window).height()*2)) {
                // temporarily unhook the scroll event watcher so we don't call a bunch of times in a row
                $(window).unbind();
                // execute the load function below that will visit the JSON feed and stuff data into the HTML
                loadItems();
            }
        };

        var loadItems = function() {
            // If the next page doesn't exist, just quit now
            if (hasNextPage === false) {
                return false
            }
            // Update the page number
            pageNum = pageNum + 1;
            // Configure the url we're about to hit
            $.ajax({
                url: '/plants/search',
                data: {page_number: pageNum},
                dataType: 'json',
                success: function(data) {
                    console.log(data);
                    // Update global next page variable
                    hasNextPage = true;//.hasNext;
                    // Loop through all items
                    data.forEach(function (collection, index) {
                        let collectionItem = document.createElement("li");
                        collectionItem.textContent = collection.species.name;
                        // collectionItem.textContent = collection.species;
                        $("#newItems").before(collectionItem);
                        // Do something with your json object response
                    });
                },
                error: function(data) {
                    // When I get a 400 back, fail safely
                    hasNextPage = false
                },
                complete: function(data, textStatus){
                    // Turn the scroll monitor back on
                    $(window).bind('scroll', loadOnScroll);
                }
            });
        };
    </script>
{% endblock %}

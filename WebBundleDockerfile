FROM node:lts-alpine AS front
WORKDIR /app
COPY frontend/package*.json .
RUN npm install
COPY ./frontend .
RUN npm run build

FROM python:3.12
LABEL maintainer="avery.uslaner@redbutte.utah.edu"

# Set environment variables
ENV PYTHONUNBUFFERED=1
ENV DJANGO_ENV=dev

RUN apt update && apt install -y libpq-dev  # Dependency for psycopg2

COPY ./redbuttegarden/requirements.txt /backend/requirements.txt
RUN pip install --upgrade pip
# Install any needed packages specified in requirements.txt
RUN pip install -r /backend/requirements.txt
RUN pip install django-debug-toolbar

COPY --from=front /app/assets/webpack_bundles /frontend/assets/webpack_bundles/
COPY --from=front /app/webpack-stats.json /frontend/webpack-stats.json

# Set the working directory to /backend/
WORKDIR /backend/